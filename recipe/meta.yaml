{% set version = "5.6.3" %}

package:
  name: xz
  version: {{ version }}

source:
  url: https://github.com/tukaani-project/xz/releases/download/v{{ version }}/xz-{{ version }}.tar.gz
  sha256: b1d45295d3f71f25a4c9101bd7c8d16cb56348bbef3bbc738da0351e17c73317

build:
  number: 0
  run_exports:
    # XZ's track record of backcompat is very good.  Keep default pins (next major version)
    #    https://abi-laboratory.pro/tracker/timeline/xz/
    - {{ pin_subpackage('xz') }}

requirements:
  build:
    - {{ stdlib('c') }}
    - {{ compiler('c') }}
    - cmake  # [win]
    - ninja  # [win]
    - make  # [not win]
    - automake  # [not win]
    - libtool  # [not win]

outputs:
  - name: xz
    script: install.sh  # [unix]
    script: install.bat  # [win]
    test:
      commands:
        - xz --help  # [not win]
        - unxz --help  # [not win]
        - lzma --help  # [not win]
        - xz.exe --help  # [win]
        - unxz.exe --help  # [win]
        - if not exist %LIBRARY_PREFIX%\bin\liblzma.dll exit 1  # [win]
        - if not exist %LIBRARY_PREFIX%\lib\liblzma.lib exit 1  # [win]
        - if not exist %LIBRARY_PREFIX%\include\lzma.h exit 1  # [win]
        - test -f ${PREFIX}/lib/liblzma${SHLIB_EXT}  # [unix]
        - test ! -f ${PREFIX}/lib/liblzma.a          # [unix]
  - name: xz-static
    script: install.sh  # [unix]
    script: install.bat  # [win]
    requirements:
      build:
        - {{ stdlib('c') }}
        - {{ compiler('c') }}
        - cmake  # [win]
        - ninja  # [win]
        - make  # [not win]
        - automake  # [not win]
      host:
        - {{ pin_subpackage('xz', exact=True) }}
      run:
        - {{ pin_subpackage('xz', exact=True) }}
    test:
      commands:
        - test -f ${PREFIX}/lib/liblzma.a          # [unix]

about:
  home: http://tukaani.org/xz/
  license: LGPL-2.1 and GPL-2.0
  license_file: COPYING
  summary: Data compression software with high compression ratio
  description: |
    XZ Utils is free general-purpose data compression software with a high
    compression ratio. XZ Utils were written for POSIX-like systems, but also
    work on some not-so-POSIX systems.
  doc_url: http://tukaani.org/xz/
  doc_source_url: https://github.com/xz-mirror/xz/blob/master/README
  dev_url: http://git.tukaani.org/

extra:
  recipe-maintainers:
    - msarahan
    - ocefpaf
    - mingwandroid
    - nehaljwani
    - scopatz
    - xhochy
