{% set version = "5.4.5" %}

package:
  name: xz-split
  version: {{ version }}

source:
  url: http://downloads.sourceforge.net/project/lzmautils/xz-{{ version }}.tar.bz2
  sha256: 8ccf5fff868c006f29522e386fb4c6a1b66463fbca65a4cfc3c4bd596e895e79
  # patches:
  #   - 0002-Add-gettimeofday-for-VS2008.patch

build:
  skip: true  # [unix]
  number: 1

requirements:
  build:
    - {{ compiler('c') }}
    - cmake <=3.26  # [win]
    - ninja         # [win]
    - make          # [unix]
    - automake      # [unix]
    - libtool       # [unix]
    - getopt-win32  # [win]

outputs:
  - name: xz
    script: install.sh   # [unix]
    script: install_lib.bat  # [win]
    build:
      run_exports:
        # XZ's track record of backcompat is very good.  Keep default pins (next major version)
        #    https://abi-laboratory.pro/tracker/timeline/xz/
        - {{ pin_subpackage('xz') }}
    requirements:
      build:
        - {{ compiler('c') }}
        - cmake <=3.26  # [win]
        - ninja         # [win]
        - getopt-win32  # [win]
        - make      # [unix]
        - automake  # [unix]
        - libtool   # [unix]
        - make      # [unix]
    test:
      commands:
        - test -f ${PREFIX}/bin/xz                   # [unix]
        - test -f ${PREFIX}/bin/unxz                 # [unix]
        - test -f ${PREFIX}/bin/lzma                 # [unix]
        - xz --help                                  # [unix]
        - unxz --help                                # [unix]
        - lzma --help                                # [unix]
        - test -f ${PREFIX}/lib/liblzma${SHLIB_EXT}  # [unix]
        - test ! -f ${PREFIX}/lib/liblzma.a          # [unix]
        - dir %PREFIX%\Library\bin  # [win]
        - if not exist %LIBRARY_PREFIX%\bin\liblzma.dll exit 1  # [win]
        - if not exist %LIBRARY_PREFIX%\lib\liblzma.lib exit 1  # [win]
        - if not exist %LIBRARY_PREFIX%\include\lzma.h exit 1   # [win]
        - if not exist %LIBRARY_PREFIX%\bin\xz.exe exit 1       # [win]
        - if not exist %LIBRARY_PREFIX%\bin\unxz.exe exit 1     # [win]
        - xz.exe --help                                         # [win]
        - unxz.exe --help                                       # [win]

  # - name: xz-static
  #   script: install.sh   # [unix]
  #   script: install.bat  # [win]
  #   requirements:
  #     build:
  #       - {{ compiler('c') }}
  #       - cmake <=3.26  # [win]
  #       - ninja         # [win]
  #       - make          # [unix]
  #       - automake      # [unix]
  #     host:
  #       - {{ pin_subpackage('xz', exact=True) }}
  #     run:
  #       - {{ pin_subpackage('xz', exact=True) }}
  #   test:
  #     commands:
  #       - test -f ${PREFIX}/lib/liblzma.a  # [unix]

about:
  home: http://tukaani.org/xz/
  license: LGPL-2.1-or-later AND GPL-2.0-or-later
  license_file: COPYING
  summary: Data compression software with high compression ratio
  description: |
    XZ Utils is free general-purpose data compression software with a high
    compression ratio. XZ Utils were written for POSIX-like systems, but also
    work on some not-so-POSIX systems.
  doc_url: http://tukaani.org/xz/
  doc_source_url: https://github.com/xz-mirror/xz/blob/master/README
  dev_url: http://git.tukaani.org/

extra:
  recipe-maintainers:
    - msarahan
    - ocefpaf
    - mingwandroid
    - nehaljwani
    - scopatz
  feedstock-name: xz
